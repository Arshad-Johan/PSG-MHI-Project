<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='dashboard.css') }}">
    <title>Dashboard</title>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <h2>PSG MHI Project</h2>
        <ul>
            <li><a href="#">Dashboard</a></li>
            <li><a href="#">Profile</a></li>
            <li><a href="#">Settings</a></li>
            <li><a href="{{ url_for('logout_view') }}">Logout</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <header class="main-header" id="heading">
            <h1>Welcome to PSG MHI Dashboard</h1>
        </header>
        <div class="container">
            <!-- Machines Card -->
            <div class="card" id="machines-card" onclick="showMotorCards()">
                <h3>Jabbal's Machine</h3>
                <p>Click to view all motors</p>
            </div>
            
            <!-- Button to go back to Machines -->
            <button id="back-button" style="display: none;" onclick="goBackToMachines()">Back to Machines</button>

            <!-- Motor Data Cards -->
            <div class="motor-cards-container" id="motor-cards-container" style="display: none;"></div>
        </div>
    </div>

    <script>
        // Function to fetch motor data and display the cards dynamically
        function showMotorCards() {
            fetch('/machines_data')
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById("motor-cards-container");
                    const backButton = document.getElementById("back-button");
                    document.getElementById("heading").style.display = "none";
                    container.style.display = "flex";
                    backButton.style.display = "block";
                    document.getElementById("machines-card").style.display = "none";

                    container.innerHTML = '';

                    data.forEach(motor => {
                        const motorCard = document.createElement("div");
                        motorCard.classList.add("motor-card");

                        motorCard.innerHTML = `
                            <h3>Serial Number: ${motor["serial number"]}</h3>
                            <p><strong>Date:</strong> ${motor["date"]}</p>
                            <p><strong>Machine Model:</strong> ${motor["machine-model"]}</p>
                            <p><strong>Surge Error:</strong> ${motor["surge error"]}</p>
                            <p><strong>Voltage:</strong> ${motor["Voltage"] || "N/A"}</p>
                            <p><strong>Tests:</strong></p>
                            <ul>
                                ${motor["tests"].map(test => `<li>${test}</li>`).join('')}
                            </ul>
                        `;
                        container.appendChild(motorCard);
                    });
                })
                .catch(error => {
                    console.error("Error fetching motor data:", error);
                });
        }

        function goBackToMachines() {
            const container = document.getElementById("motor-cards-container");
            const backButton = document.getElementById("back-button");
            document.getElementById("heading").style.display = "block";
            container.style.display = "none";
            backButton.style.display = "none";
            document.getElementById("machines-card").style.display = "block";
        }
    </script>
</body>
</html>
